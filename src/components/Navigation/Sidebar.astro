---
interface Item {
  title: string;
  slug: string;
  order: number;
}

interface Group {
  key: string;
  title: string;
  items: Item[];
}

interface Props {
  groups: Group[];
  currentSlug: string;
}

const { groups, currentSlug } = Astro.props;
const base = import.meta.env.BASE_URL;
const withBase = (path: string) => (base === '/' ? path : `${base.replace(/\/$/, '')}${path}`);
---

<aside class="w-full lg:w-72 lg:sticky lg:top-[90px] lg:self-start bg-secondary/85 border border-slate-900/10 rounded-xl p-4 lg:p-5 backdrop-blur-sm max-h-[calc(100vh-108px)] overflow-y-auto overscroll-contain sidebar-scroll">
  <p class="text-xs tracking-widest text-slate-500 mb-4 font-mono">CHAPTERS</p>

  <nav class="space-y-4">
    {groups.map((group) => (
      <section>
        <h3 class="text-xs font-semibold text-slate-500 mb-2 uppercase tracking-wide">{group.title}</h3>
        <ul class="space-y-1.5">
          {group.items
            .sort((a, b) => a.order - b.order)
            .map((item) => {
              const active = item.slug === currentSlug;
              return (
                <li>
                  <a
                    href={withBase(`/docs/${item.slug}`)}
                    class:list={[
                      'block rounded-md px-3 py-2 text-sm transition-colors leading-relaxed',
                      active
                        ? 'bg-accent/15 text-accent border border-accent/30'
                        : 'text-slate-600 hover:text-slate-900 hover:bg-slate-900/5 border border-transparent',
                    ]}
                  >
                    {item.title}
                  </a>
                </li>
              );
            })}
        </ul>
      </section>
    ))}
  </nav>
</aside>
