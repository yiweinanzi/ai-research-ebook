---
import Layout from './Layout.astro';
import Sidebar from '../components/Navigation/Sidebar.astro';
import TableOfContents from '../components/TableOfContents.astro';

interface DocItem {
  slug: string;
  title: string;
  order: number;
}

interface Group {
  key: string;
  title: string;
  items: DocItem[];
}

interface Heading {
  depth: number;
  slug: string;
  text: string;
}

interface Props {
  title: string;
  description?: string;
  currentSlug: string;
  groups: Group[];
  headings?: Heading[];
  prev?: DocItem | null;
  next?: DocItem | null;
}

const { title, description = '', currentSlug, groups, headings = [], prev = null, next = null } = Astro.props;
const base = import.meta.env.BASE_URL;
const withBase = (path: string) => (base === '/' ? path : `${base.replace(/\/$/, '')}${path}`);
---

<Layout title={`${title} | Vibe Research`} description={description}>
  <section class="py-12">
    <div class="max-w-[1500px] mx-auto px-4 md:px-6 xl:px-8 flex flex-col lg:flex-row gap-5 xl:gap-7">
      <Sidebar groups={groups} currentSlug={currentSlug} />

      <article class="flex-1 min-w-0 bg-secondary/60 border border-white/10 rounded-2xl p-6 md:p-9 backdrop-blur-sm">
        <div class="mb-7 pb-6 border-b border-white/10">
          <p class="text-xs font-mono tracking-widest text-gray-500 mb-2">DOCS</p>
          <h1 class="text-3xl md:text-[2.55rem] font-bold text-white leading-tight">{title}</h1>
          {description && <p class="mt-3 text-gray-400 text-[1.02rem] leading-relaxed">{description}</p>}
        </div>

        <div class="markdown-content">
          <slot />
        </div>

        {(prev || next) && (
          <div class="mt-10 pt-6 border-t border-white/10 grid gap-4 sm:grid-cols-2">
            <div>
              {prev && (
                <a href={withBase(`/docs/${prev.slug}`)} class="block rounded-xl border border-white/10 p-4 hover:border-accent/40 transition-colors bg-white/5">
                  <p class="text-xs text-gray-500 mb-2">上一篇</p>
                  <p class="font-semibold text-white">{prev.title}</p>
                </a>
              )}
            </div>
            <div>
              {next && (
                <a href={withBase(`/docs/${next.slug}`)} class="block rounded-xl border border-white/10 p-4 hover:border-accent/40 transition-colors bg-white/5 text-right">
                  <p class="text-xs text-gray-500 mb-2">下一篇</p>
                  <p class="font-semibold text-white">{next.title}</p>
                </a>
              )}
            </div>
          </div>
        )}
      </article>

      <TableOfContents headings={headings} />
    </div>
  </section>
</Layout>
